<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>ÙØ§ØªÙˆØ±Ø© Ø§Ù„ØªÙ‚Ø³ÙŠØ· - {{ customer.name }}</title>

    <style>
    /* ======== COMPACT A5 SPECIAL EDITION ğŸ˜ğŸ”¥ ======== */
    body {
        font-family: Tahoma, Arial, sans-serif;
        direction: rtl;
        background: #fff;
        margin: 0;
        padding: 0;
        font-size: 12px;           /* Ø£ØµØºØ± */
        line-height: 1.2;          /* Ø³Ø·ÙˆØ± Ù…ØªÙ‚Ø§Ø±Ø¨Ø© */
    }

    .invoice {
        width: 148mm;
        min-height: 210mm;
        background: white;
        margin: auto;
        padding: 6mm;              /* â†“â†“ Ø£Ù‚Ù„ */
        box-sizing: border-box;
    }

    h2, h3, h4 {
        margin: 2px 0;
        font-size: 16px;           /* â†“ Ø£ØµØºØ± Ø´ÙˆÙŠ */
    }

    p {
        margin: 1px 0;
        font-size: 12px;
    }

    /* ====== PRODUCT BOX ====== */
    .product-box {
        border: 1px solid #777;
        padding: 5px;              /* â†“â†“â†“ */
        border-radius: 6px;
        margin-bottom: 10px;       /* â†“â†“ Ø¨Ø¯Ù„ 20 */
        background: #fafafa;
    }

    .product-box h3 {
        font-size: 14px;           /* â†“ */
        margin-bottom: 3px;
    }

    /* ====== TABLE ====== */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 5px;           /* â†“ */
        font-size: 11px;           /* â†“â†“â†“ */
    }

    th, td {
        border: 1px solid #444;
        padding: 3px;              /* â†“â†“â†“ */
        line-height: 1.1;          /* â†“â†“â†“ */
    }

    th {
        background: #e4e4e4;
        font-size: 11px;
    }

    /* watermark Ø£ØµØºØ± */
    .watermark {
        position: absolute;
        border-radius: 50%;
        top: 40%;
        left: 50%;
        width: 140px;              /* â†“â†“â†“ */
        opacity: 0.50;
        transform: translate(-50%, -50%);
    }

    /* Ø·Ø¨Ø§Ø¹Ø© */
    @media print {
        @page {
            size: A5 portrait;
            margin: 4mm;           /* â†“â†“â†“ */
        }

        body {
            font-size: 11px !important;
            line-height: 1.1 !important;
        }

        .invoice {
            padding: 5mm !important;
        }

        .product-box {
            margin-bottom: 8px !important;
        }

        table th, table td {
            padding: 2px !important;
        }
    }

    </style>
</head>

<body>

<div class="invoice">

    <!-- Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© -->
    <img src="{{ url_for('static', filename='images/logo.jpg') }}" class="watermark">

    <h2>Ù…Ø¹Ø±Ø¶ Ø¨ÙƒÙ‘ÙˆØ±</h2>
    <h3>ÙØ§ØªÙˆØ±Ø© ØªÙ‚Ø³ÙŠØ·</h3>

    <p><strong>Ø§Ù„Ø²Ø¨ÙˆÙ†:</strong> {{ customer.name }}</p>
    <p><strong>ID:</strong> {{ customer.custom_id }}</p>

    <hr>

    <!-- ======= Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙ‚Ø³ÙŠØ· ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¯Ø¯Ø© ======= -->
    {% for product in products %}
        <div class="product-box">

            <h3>Ø§Ù„Ù…Ù†ØªØ¬: {{ product.name }}</h3>
            <p><strong>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ:</strong> {{ product.total_price }} $</p>
            <p><strong>Ø§Ù„Ø³Ù„ÙØ©:</strong> {{ product.initial_payment }} $</p>
            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</strong> {{ product.date_added.strftime('%Y-%m-%d') }}</p>

            <h4>Ø§Ù„Ø¯ÙØ¹Ø§Øª</h4>

            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                    </tr>
                </thead>

                <tbody>
                    {% set remaining = product.total_price - product.initial_payment %}

                    {% if product.initial_payment > 0 %}
                        <tr>
                            <td>{{ product.initial_payment }} $ <small style="color:blue">(Ø³Ù„ÙØ©)</small></td>
                            <td>{{ product.date_added.strftime('%Y-%m-%d') }}</td>
                            <td>{{ remaining }} $</td>
                        </tr>
                    {% endif %}

                    {% for p in product.payments|sort(attribute='date_paid') %}
                        {% set remaining = remaining - p.amount %}
                        <tr>
                            <td>
                                {{ p.amount }} $
                                {% if loop.index == 1 and product.initial_payment == p.amount %}
                                    <span style="color:#007bff; font-size:11px;">(Ø³Ù„ÙØ©)</span>
                                {% endif %}
                            </td>
                            <td>{{ p.date_paid.strftime('%Y-%m-%d') }}</td>
                            <td>{{ remaining if remaining > 0 else 0 }} $</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <p><strong>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong> {{ remaining if remaining > 0 else 0 }} $</p>

        </div>
    {% endfor %}

</div>

<script>
    window.print();
</script>

</body>
</html>
