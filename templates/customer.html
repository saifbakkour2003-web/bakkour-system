<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    {% extends "base.html" %}
    <title>ØµÙØ­Ø© Ø§Ù„Ø²Ø¨ÙˆÙ† - {{ customer.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
{% block content %}
<div class="container">
    <!-- ======= Header ======= -->
    <header class="main-header">
        <h1>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø²Ø¨ÙˆÙ†: {{ customer.name }} (ID: {{ customer.custom_id }})</h1>
        <p>Ø§Ù„Ù‡Ø§ØªÙ: {{ customer.phone }} | Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: {{ customer.notes }}</p>
        <div class="actions">
            <a href="{{ url_for('edit_customer', id=customer.id) }}" class="btn">ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†</a>
            <form action="{{ url_for('delete_customer', id=customer.id) }}" method="POST"
                onsubmit="return confirm('Ù…ØªØ£ÙƒØ¯ Ø¨Ø¯Ùƒ ØªØ­Ø°Ù Ø§Ù„Ø²Ø¨ÙˆÙ† ÙˆÙƒÙ„ Ø³Ø¬Ù„Ø§ØªÙ‡ØŸ ğŸ˜¢');"
                style="display:inline-block;">
                <button type="submit" class="btn-delete">Ø­Ø°Ù Ø§Ù„Ø²Ø¨ÙˆÙ†</button>
            </form>
            <a class="btn" href="{{ url_for('print_invoice', id=customer.id) }}">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</a>
            {% if customer.ledger != "Ø¯ÙŠÙˆÙ† Ù†Ù‚Ø¯ÙŠØ©" %}
            <a class="btn" href="{{ url_for('installments_invoice', id=customer.id) }}">Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© Ø§Ù„ØªÙ‚Ø³ÙŠØ·</a>
{% endif %}

        </div>
    </header>

    {% if customer.ledger != "Ø¯ÙŠÙˆÙ† Ù†Ù‚Ø¯ÙŠØ©" %}
    <!-- ======= Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙ‚Ø³ÙŠØ· ======= -->
    <h3>Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙ‚Ø³ÙŠØ·</h3>
    <a href="{{ url_for('add_installment_product', id=customer.id) }}" class="btn">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ ØªÙ‚Ø³ÙŠØ·</a>
    <table>
        <thead>
            <tr>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ</th>
                <th>Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</th>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                <th>Ù…Ø¯ÙÙˆØ¹/Ù„Ù… ÙŠÙØ¯ÙØ¹</th>
                <th>Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</th>
            </tr>
        </thead>
        <tbody>
            {% for product in installment_products %}
            <tr>
                <td>{{ product.name }}</td>
                <td>{{ product.total_price }} $</td>
                <td>{{ product.monthly_installment }} $</td>
                <td>{{ product.date_added.strftime('%Y-%m-%d') }}</td>
                <td>
                    {% if product.paid_off %}
                    <span style="color: green; font-weight: bold;">Ù…Ø¯ÙÙˆØ¹</span>

                        <!-- Ø²Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
                        <a href="{{ url_for('close_installment_invoice', id=product.id) }}"
                            class="btn"
                            style="padding: 3px 8px; font-size: 12px; margin-right: 5px;">
                            Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
                        </a>

                    {% else %}
                        <span style="color: red; font-weight: bold;">Ù„Ù… ÙŠÙØ¯ÙØ¹</span>
                    {% endif %}


                </td>
                <td>
                    <form action="{{ url_for('delete_installment_product', id=product.id) }}" method="post" style="display:inline;">
                        <button type="submit" class="btn-delete">Ø­Ø°Ù</button>
                    </form>
                    <a href="{{ url_for('add_installment_payment', id=product.id) }}" class="btn">Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø©</a>
                </td>
            </tr>
            <tr>
                <td colspan="6">
                    <strong>Ø§Ù„Ø³Ù„ÙØ©: {{ product.initial_payment }} $</strong>
                    <table class="payments-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹</th>
                                <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in installment_details %}
                                {% if item.product.id == product.id %}
                                    {% for p in item.payments %}
                                        <tr>
                                            <td>
                                                {{ p.amount }} $
                                                {% if loop.first and p.amount == product.initial_payment %}
                                                    <span style="color:#007bff; font-size:12px;">(Ø³Ù„ÙØ©)</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ p.date.strftime('%Y-%m-%d') }}</td>
                                            <td>{{ p.remaining }} $</td>
                                        </tr>
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    <!-- ======= Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© ======= -->
    <h3>Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©</h3>

    <!-- Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ù†Ù‚Ø¯ÙŠ Ø¬Ø¯ÙŠØ¯ -->
    <a href="{{ url_for('add_cash_debt', id=customer.id) }}" class="btn">Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ù†Ù‚Ø¯ÙŠ</a>

    <p><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©:</strong> {{ total_cash_debt }} $</p>

    <!-- Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø© Ø¹Ø§Ù…Ø© Ø¥Ø°Ø§ ÙÙŠ Ù…Ø¨Ù„Øº Ù…Ø³ØªØ­Ù‚ -->
    {% if total_cash_debt > 0 %}
        <a href="{{ url_for('add_general_cash_payment', id=customer.id) }}" class="btn">
            Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø© Ø¹Ø§Ù…Ø©
        </a>
    {% endif %}

    <!-- Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙˆØ§Ù„Ø¯ÙØ¹Ø§Øª -->
    {% set remaining = total_cash_debt %}
    <table style="width:100%; border-collapse:collapse;">
        <thead>
            <tr>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„Ø³Ø¹Ø±</th>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
            </tr>
        </thead>
        <tbody>
            {% for debt in cash_debts %}
            <tr>
                <td>{{ debt.name }}</td>
                <td>{{ debt.price }} $</td>
                <td>{{ debt.date_added.strftime('%Y-%m-%d') }}</td>
            </tr>
            {% endfor %}
            {% for payment in customer.general_cash_payments %}
            <tr>
                <td style="color:green;">Ø¯ÙØ¹Ø© Ø¹Ø§Ù…Ø©</td>
                <td class="amount">{{ payment.amount }}$</td>
                <td class="date">{{ payment.date_paid.strftime('%Y-%m-%d') }}</td>
            </tr>
            {% endfor %}

        </tbody>
    </table>

    <p><strong>Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong> {{ remaining_cash }} $</p>

</div>
{% endblock %}
</body>
</html>
